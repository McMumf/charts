apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kompose.cmd: C:\Users\mccaf\go\bin\kompose.exe convert
    kompose.version: 1.34.0 (HEAD)
  labels:
    io.kompose.service: penpot-backend
  name: penpot-backend
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: penpot-backend
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        kompose.cmd: C:\Users\mccaf\go\bin\kompose.exe convert
        kompose.version: 1.34.0 (HEAD)
      labels:
        io.kompose.service: penpot-backend
    spec:
      automountServiceAccountToken: false
      containers:
        - name: penpot-backend
          image: penpotapp/backend:2.1.0
          resources:
            limits:
              cpu: 2000m
              ephemeral-storage: 10Gi
              memory: 4Gi
            requests:
              cpu: 2000m
              ephemeral-storage: 10Gi
              memory: 4Gi
          ports:
            - containerPort: 80
              protocol: TCP
          env:
            - name: PENPOT_ASSETS_STORAGE_BACKEND
              value: assets-fs
            - name: PENPOT_DATABASE_PASSWORD
              value: penpot
            - name: PENPOT_DATABASE_URI
              value: postgresql://penpot-postgres/penpot
            - name: PENPOT_DATABASE_USERNAME
              value: penpot
            - name: PENPOT_FLAGS
              value: enable-registration enable-login-with-password disable-email-verification enable-smtp enable-prepl-server
            - name: PENPOT_PUBLIC_URI
              value: http://localhost:9001
            - name: PENPOT_REDIS_URI
              value: redis://penpot-redis/0
            - name: PENPOT_SMTP_DEFAULT_FROM
              value: no-reply@example.com
            - name: PENPOT_SMTP_DEFAULT_REPLY_TO
              value: no-reply@example.com
            - name: PENPOT_SMTP_HOST
              value: penpot-mailcatch
            - name: PENPOT_SMTP_PASSWORD
            - name: PENPOT_SMTP_PORT
              value: "1025"
            - name: PENPOT_SMTP_SSL
              value: "false"
            - name: PENPOT_SMTP_TLS
              value: "false"
            - name: PENPOT_SMTP_USERNAME
            - name: PENPOT_STORAGE_ASSETS_FS_DIRECTORY
              value: /opt/data/assets
            - name: PENPOT_TELEMETRY_ENABLED
              value: "true"
          volumeMounts:
            - mountPath: /opt/data/assets
              name: penpot-assets
      restartPolicy: Always
      volumes:
        - name: penpot-assets
          persistentVolumeClaim:
            claimName: penpot-assets
